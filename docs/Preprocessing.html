---

title: Data preprocessing


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/Preprocessing.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/Preprocessing.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="This-notebook-provides-functions-to-format-input-data-for-sequence-plotting">This notebook provides functions to format input data for sequence plotting<a class="anchor-link" href="#This-notebook-provides-functions-to-format-input-data-for-sequence-plotting"> </a></h2><p>The formatted input data is returned as pandas dataframe containing following columns:</p>
<ul>
<li>unique_protein_id: a single uniprot accession</li>
<li>modified_sequence: modified peptide sequence</li>
<li>naked_sequence: naked peptide sequence    </li>
<li>all_protein_ids: all UniProt IDs the peptide map to separated by ';'</li>
<li>start: peptide start position on protein sequence</li>
<li>end: peptide end position on protein sequence</li>
<li>PTMsites: list with PTM positions</li>
<li>PTMtypes: list with PTM types</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Split-protein-group-into-unique-protein-accessions">Split protein group into unique protein accessions<a class="anchor-link" href="#Split-protein-group-into-unique-protein-accessions"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <em>all_protein_ids</em> column in <em>df</em> is split by ';' to result in unique rows for each UniProt accession. The exploded dataframe has a new column <em>unique_protein_id</em>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_uniprot_id" class="doc_header"><code>extract_uniprot_id</code><a href="https://github.com/mannlabs/alphamap/tree/master/alphamap/preprocessing.py#L8" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_uniprot_id</code>(<strong><code>protein_id</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Extract the Uniprot unique entry id from the unusual formatted protein_id.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="expand_protein_ids" class="doc_header"><code>expand_protein_ids</code><a href="https://github.com/mannlabs/alphamap/tree/master/alphamap/preprocessing.py#L18" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>expand_protein_ids</code>(<strong><code>df</code></strong>:<code>DataFrame</code>)</p>
</blockquote>
<p>Function to split protein groups in 'all_protein_ids' by ';' into separate rows.
The resulting dataframe has a new column 'unique_protein_id'.
Args:
    df (pd.DataFrame): Experimental data that was imported by the 'import_data' function.
Returns:
    pd.DataFrame: Exploded dataframe with a new column 'unique_protein_id'.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Annotate-peptides-with-start-and-end-position">Annotate peptides with start and end position<a class="anchor-link" href="#Annotate-peptides-with-start-and-end-position"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <em>get_peptide_position</em> function annotates a peptide's start and end position in the given protein sequence.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pep_position_helper" class="doc_header"><code>pep_position_helper</code><a href="https://github.com/mannlabs/alphamap/tree/master/alphamap/preprocessing.py#L40" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pep_position_helper</code>(<strong><code>seq</code></strong>:<code>str</code>, <strong><code>prot</code></strong>:<code>str</code>, <strong><code>fasta</code></strong>:<code>pyteomics.fasta</code>, <strong><code>verbose</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>Helper function for 'get_peptide_position'.</p>
<p>Args:
    seq (str): Naked peptide sequence.
    prot (str): UniProt protein accession.
    fasta (fasta): Fasta file imported by pyteomics 'fasta.IndexedUniProt'.
    verbose (bool, optional): Flag to print warnings if no matching sequence is found for a protein in the provided fasta. Defaults to 'True'.
Returns:
    [int, int]: int: peptide start position, int: peptide end position</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_peptide_position" class="doc_header"><code>get_peptide_position</code><a href="https://github.com/mannlabs/alphamap/tree/master/alphamap/preprocessing.py#L73" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_peptide_position</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>fasta</code></strong>:<code>pyteomics.fasta</code>, <strong><code>verbose</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>Function to get start and end position of each peptide in the given protein.</p>
<p>Args:
    df (pd.DataFrame): Experimental data that was imported by the 'import_data' function and processed by 'expand_protein_ids'.
    fasta (fasta): Fasta file imported by pyteomics 'fasta.IndexedUniProt'.
    verbose (bool, optional): Flag to print warnings if no matching sequence is found for a protein in the provided fasta. Defaults to 'True'.
Returns:
    pd.DataFrame: Dataframe with a new columns 'start' and 'end', indicating the start and end index position of the peptide sequence.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Annotate-each-peptide-with-PTM-site-indices-and-modification-types">Annotate each peptide with PTM site indices and modification types<a class="anchor-link" href="#Annotate-each-peptide-with-PTM-site-indices-and-modification-types"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <em>get_modifications</em> function annotates sequence positions and modification types of all PTMs on a peptide.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_ptm_sites" class="doc_header"><code>get_ptm_sites</code><a href="https://github.com/mannlabs/alphamap/tree/master/alphamap/preprocessing.py#L103" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_ptm_sites</code>(<strong><code>peptide</code></strong>:<code>str</code>, <strong><code>modification_reg</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Function to get sequence positions of all PTMs of a peptide in the given protein.</p>
<p>Args:
    peptide (str): Experimental data that was imported by the 'import_data' function and processed by 'expand_protein_ids'.
    modification_reg (str): Regular expression for the modifications.
Returns:
    list: List of integers with PTM site location indices on the peptide.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_modifications" class="doc_header"><code>get_modifications</code><a href="https://github.com/mannlabs/alphamap/tree/master/alphamap/preprocessing.py#L133" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_modifications</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>mod_reg</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Function to get sequence positions and modification types of all PTMs of a peptide in the given protein.</p>
<p>Args:
    df (pd.DataFrame): Experimental data that was imported by the 'import_data' function and processed by 'expand_protein_ids'.
    mod_reg (str): Regular expression for the modifications.
Returns:
    pd.DataFrame: Dataframe with a new columns 'PTMsites' and 'PTMtypes' containing lists of PTM site indices and modification types, respectively.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Preprocessing-wrapper">Preprocessing wrapper<a class="anchor-link" href="#Preprocessing-wrapper"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <em>format_input_data</em> function is a wrapper for all previous functions described in this notebook. It calls following functios:</p>
<ul>
<li><em>expand_protein_ids</em>: to split protein groups into unique uniprot accessions</li>
<li><em>get_peptide_position</em>: to annotate each peptide with its start and end position on its respective protein sequence</li>
<li><em>get_modifications</em>: To get the sequence positions and modification types of all PTMs of a peptide.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_input_data" class="doc_header"><code>format_input_data</code><a href="https://github.com/mannlabs/alphamap/tree/master/alphamap/preprocessing.py#L152" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_input_data</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>fasta</code></strong>:<code>pyteomics.fasta</code>, <strong><code>modification_exp</code></strong>:<code>str</code>, <strong><code>verbose</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>Function to format input data and to annotate sequence start and end positions plus PTM sites.</p>
<p>Args:
    df (pd.DataFrame): Experimental data that was imported by the 'import_data' function.
    fasta (fasta): Fasta file imported by pyteomics 'fasta.IndexedUniProt'.
    modification_exp (str): Regular expression for the modifications.
    verbose (bool, optional): Flag to print warnings if no matching sequence is found for a protein in the provided fasta. Defaults to 'True'.
Returns:
    pd.DataFrame: Dataframe with unique uniprot accessions, sequence start and end positions, and PTM site information.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

